import{_ as L,r as m,c as f,I as R,s as M,h as d,i as s,j as w,w as B,v as j,t as c,F as E,l as F,C as V,o as i,n as S,m as z,x as O,E as Q,A as q,K as H}from"./index-CJ_E5GLL.js";import{s as A}from"./superadmin.service-B8FsT-jF.js";const P={name:"TenantSelectionTable",props:{userId:{type:[String,Number],required:!0}},emits:["assign","cancel"],setup(x,{emit:t}){const u=m([]),e=m(null),g=m(!0),v=m(!1),n=m(""),r=m(""),p=m(""),b=async()=>{g.value=!0,r.value="";try{const l=await A.getAssignableTenants();if(l&&l.success&&Array.isArray(l.data))u.value=l.data.map((a,T)=>{const k=a.tenant_id||a.tenantId||a.id||a.userID||a.userId||a.user_id||T+1;return{...a,id:k,tenantName:a.tenantName||a.name||"N/A",templeName:a.templeName||a.temple_name||"N/A",templeAddress:a.templeAddress||a.temple_address||a.location||"N/A",status:a.status||"active",originalData:a}});else throw new Error((l==null?void 0:l.message)||"Failed to fetch tenants")}catch(l){r.value=l.message||"Failed to fetch tenants",u.value=[]}finally{g.value=!1}},N=f(()=>{if(!n.value)return u.value;const l=n.value.toLowerCase();return u.value.filter(a=>String(a.id).toLowerCase().includes(l)||(a.tenantName||"").toLowerCase().includes(l)||(a.templeName||"").toLowerCase().includes(l)||(a.templeAddress||"").toLowerCase().includes(l))}),I=f(()=>u.value.find(l=>l.id===e.value)),_=l=>{e.value=l},D=async()=>{var a,T,k,U;if(!e.value)return r.value="Please select a tenant";const l=I.value;if(!l)return r.value="Invalid tenant selection";v.value=!0,r.value="",p.value="";try{const h=((a=l.originalData)==null?void 0:a.tenant_id)||((T=l.originalData)==null?void 0:T.tenantId)||l.id,y=await A.assignUserToTenant(Number(x.userId),h);y!=null&&y.success?(p.value=y.message||"User assigned successfully",t("assign",{tenantId:h,tenant:l,userId:x.userId}),e.value=null,setTimeout(()=>{p.value=""},3e3)):r.value=(y==null?void 0:y.message)||"Assignment failed"}catch(h){r.value=((U=(k=h.response)==null?void 0:k.data)==null?void 0:U.message)||h.message||"Unexpected error"}finally{v.value=!1}},C=()=>{r.value=""},o=async()=>{e.value=null,await b()};return R(()=>x.userId,()=>{e.value=null,r.value="",p.value=""}),M(b),{tenants:u,selectedTenantId:e,filteredTenants:N,loading:g,assigning:v,searchQuery:n,assignError:r,successMessage:p,assignSelected:D,clearError:C,refreshTenants:o,onTenantSelect:_}}},K={class:"tenant-selection-container"},G={class:"mb-4 flex items-center justify-between"},J={class:"relative w-64"},W={key:0,class:"mb-4 p-2 bg-blue-50 rounded text-sm text-blue-700"},X={key:1,class:"mb-4 bg-red-50 border border-red-200 rounded-lg p-4"},Y={class:"flex"},Z={class:"ml-3"},$={class:"text-sm text-red-700 mt-1"},ee={key:2,class:"mb-4 bg-green-50 border border-green-200 rounded-lg p-4"},se={class:"flex"},te={class:"ml-3"},ne={class:"text-sm text-green-700 mt-1"},ae={key:3,class:"py-10 flex justify-center"},le={key:4,class:"text-center py-8"},re={class:"text-gray-500"},oe={key:5,class:"overflow-x-auto"},ie={class:"min-w-full divide-y divide-gray-200"},de={class:"bg-white divide-y divide-gray-200"},ce={class:"px-6 py-4 whitespace-nowrap"},ue=["value","onChange"],ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono"},me={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ve={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},pe={class:"px-6 py-4 whitespace-nowrap"},ye={class:"mt-6 flex justify-end space-x-3"},fe=["disabled"],be={key:0,class:"flex items-center"},_e={key:1};function he(x,t,u,e,g,v){return i(),d("div",K,[s("div",G,[t[7]||(t[7]=s("h3",{class:"text-lg font-medium"},"Select Tenant to Assign",-1)),s("div",J,[B(s("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>e.searchQuery=n),placeholder:"Search tenants...",type:"search",class:"w-full border border-gray-300 rounded-lg py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[j,e.searchQuery]]),t[6]||(t[6]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e.selectedTenantId?(i(),d("div",W," Selected Tenant ID: "+c(e.selectedTenantId)+" (Type: "+c(typeof e.selectedTenantId)+") ",1)):w("",!0),e.assignError?(i(),d("div",X,[s("div",Y,[t[9]||(t[9]=s("svg",{class:"h-5 w-5 text-red-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:`M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 
            1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 
            1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 
            00-1.414-1.414L10 8.586 8.707 7.293z`,"clip-rule":"evenodd"})],-1)),s("div",Z,[t[8]||(t[8]=s("h3",{class:"text-sm font-medium text-red-800"},"Assignment Failed",-1)),s("p",$,c(e.assignError),1),s("button",{onClick:t[1]||(t[1]=(...n)=>e.clearError&&e.clearError(...n)),class:"text-sm text-red-600 underline mt-2"},"Dismiss")])])])):w("",!0),e.successMessage?(i(),d("div",ee,[s("div",se,[t[11]||(t[11]=s("svg",{class:"h-5 w-5 text-green-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),s("div",te,[t[10]||(t[10]=s("h3",{class:"text-sm font-medium text-green-800"},"Success",-1)),s("p",ne,c(e.successMessage),1)])])])):w("",!0),e.loading?(i(),d("div",ae,[...t[12]||(t[12]=[s("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"},null,-1)])])):e.filteredTenants.length===0?(i(),d("div",le,[s("p",re,c(e.tenants.length===0?"No tenants available":"No tenants match your search"),1),s("button",{onClick:t[2]||(t[2]=(...n)=>e.refreshTenants&&e.refreshTenants(...n)),class:"mt-2 text-indigo-600 hover:text-indigo-800 underline"},"Refresh Tenants")])):(i(),d("div",oe,[s("table",ie,[t[13]||(t[13]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Select"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tenant ID"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tenant Name"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Temple Name"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Location"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status")])],-1)),s("tbody",de,[(i(!0),d(E,null,F(e.filteredTenants,n=>(i(),d("tr",{key:`tenant-${n.id}`,class:S([{"bg-indigo-50":e.selectedTenantId===n.id},"hover:bg-gray-50"])},[s("td",ce,[B(s("input",{type:"radio",name:"selectedTenant",value:n.id,"onUpdate:modelValue":t[3]||(t[3]=r=>e.selectedTenantId=r),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",onChange:r=>e.onTenantSelect(n.id)},null,40,ue),[[z,e.selectedTenantId]])]),s("td",ge,c(n.id),1),s("td",me,c(n.tenantName),1),s("td",ve,c(n.templeName),1),s("td",xe,c(n.templeAddress),1),s("td",pe,[s("span",{class:S(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800":n.status==="active"||n.status==="approved","bg-yellow-100 text-yellow-800":n.status==="pending","bg-red-100 text-red-800":n.status==="inactive"||n.status==="rejected"}])},c(n.status||"active"),3)])],2))),128))])])])),s("div",ye,[s("button",{onClick:t[4]||(t[4]=n=>x.$emit("cancel")),class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300"},"Cancel"),s("button",{onClick:t[5]||(t[5]=(...n)=>e.assignSelected&&e.assignSelected(...n)),disabled:!e.selectedTenantId||e.assigning,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed"},[e.assigning?(i(),d("span",be,[...t[14]||(t[14]=[s("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),V(" Assigning... ",-1)])])):(i(),d("span",_e,"Assign Selected"))],8,fe)])])}const we=L(P,[["render",he],["__scopeId","data-v-a2f7a49e"]]),Te={name:"AssignTenantsView",components:{TenantSelectionTable:we},setup(){const x=q(),t=Q(),u=m(t.params.userId),e=m({}),g=m(!0),v=m(""),n=f(()=>e.value?typeof e.value.role=="string"?e.value.role:typeof e.value.role=="object"&&(e.value.role.roleName||e.value.role.role_name)||"":""),r=f(()=>{const o=n.value.toLowerCase().replace(/\s+/g,"");return["standarduser","monitoringuser"].includes(o)}),p=f(()=>e.value.tenantAssigned||e.value.tenant_assigned||e.value.tenant_assignment_details&&e.value.tenant_assignment_details.tenantName||""),b=o=>{if(!o)return"";try{return new Date(o).toISOString().split("T")[0]}catch{return""}},N=f(()=>{const o=e.value.assignedDate||e.value.tenant_assignment_details&&e.value.tenant_assignment_details.assignedOn;return b(o)}),I=f(()=>{const o=e.value.reassignmentDate||e.value.tenant_assignment_details&&e.value.tenant_assignment_details.updatedOn;return b(o)}),_=async()=>{g.value=!0,v.value="";try{const o=await A.getUserById(u.value);o.success&&o.data?(e.value=o.data,console.log("User data received:",o.data),!e.value.tenantAssigned&&e.value.tenant_assignment_details&&(e.value.tenantAssigned=e.value.tenant_assignment_details.tenantName)):v.value=o.message||"Failed to load user details"}catch(o){v.value="An error occurred while loading user details. Please try again.",console.error(o)}finally{g.value=!1}},D=async({tenantId:o,tenantName:l})=>{if(!o)return alert("Invalid tenant selected");if(!r.value)return alert("This user cannot be assigned tenants");g.value=!0;try{const a=await A.assignUserToTenant(u.value,o);a.success?(alert("Tenant assigned successfully"),await _()):alert(a.message||"Failed to assign tenant")}catch(a){console.error(a),alert("An error occurred while assigning tenant")}finally{g.value=!1}},C=()=>x.push({name:"SuperadminUserManagement"});return M(_),{userId:u,user:e,loading:g,error:v,fetchUserDetails:_,goBack:C,userRole:n,canAssignTenants:r,assignTenantHandler:D,displayTenantName:p,displayAssignedDate:N,displayReassignmentDate:I}}},ke={class:"assign-tenants-view"},Ae={class:"mb-4"},Ne={class:"flex items-center"},Ie={class:"bg-white rounded-xl shadow-sm border border-gray-200 mb-6"},De={class:"p-6 border-b border-gray-200 flex justify-between items-center"},Ce={class:"p-6"},Se={key:0,class:"py-10 flex justify-center"},Ue={key:1,class:"bg-red-50 border border-red-200 rounded p-4 mb-6"},Be={class:"text-red-700"},Le={key:2},Me={class:"bg-indigo-50 border border-indigo-100 rounded p-4 mb-6"},Re={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},je={class:"font-medium"},Ee={class:"font-medium"},Fe={class:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-indigo-100 text-indigo-800"},Ve={class:"font-medium"},ze={key:0},Oe={class:"font-medium"},Qe={class:"px-2 py-1 inline-flex text-xs leading-5 font-medium rounded bg-gray-100 text-gray-800"},qe={key:1},He={class:"font-medium"},Pe={class:"px-2 py-1 inline-flex text-xs leading-5 font-medium rounded bg-blue-100 text-blue-800"},Ke={key:0,class:"bg-yellow-50 border border-yellow-200 rounded p-4 mb-6"};function Ge(x,t,u,e,g,v){const n=H("tenant-selection-table");return i(),d("div",ke,[s("div",Ae,[s("div",Ne,[s("a",{onClick:t[0]||(t[0]=(...r)=>e.goBack&&e.goBack(...r)),class:"cursor-pointer text-indigo-600 hover:text-indigo-800 mr-2"},[...t[3]||(t[3]=[s("svg",{class:"w-5 h-5 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),t[4]||(t[4]=s("div",null,[s("h2",{class:"text-xl font-bold"},"Assign Tenants to User")],-1))])]),s("div",Ie,[s("div",De,[t[5]||(t[5]=s("h2",{class:"text-lg font-semibold"},"Assign Tenants to User",-1)),s("button",{onClick:t[1]||(t[1]=(...r)=>e.goBack&&e.goBack(...r)),class:"px-3 py-1.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"}," Back ")]),s("div",Ce,[e.loading?(i(),d("div",Se,[...t[6]||(t[6]=[s("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"},null,-1)])])):e.error?(i(),d("div",Ue,[s("p",Be,c(e.error),1),s("button",{onClick:t[2]||(t[2]=(...r)=>e.fetchUserDetails&&e.fetchUserDetails(...r)),class:"text-red-600 mt-2 underline"},"Retry")])):(i(),d("div",Le,[s("div",Me,[t[13]||(t[13]=s("h3",{class:"font-medium text-indigo-800 mb-2"},"User Details",-1)),s("div",Re,[s("div",null,[t[7]||(t[7]=s("p",{class:"text-gray-500 text-sm"},"Name",-1)),s("p",je,c(e.user.full_name||e.user.fullName),1)]),s("div",null,[t[8]||(t[8]=s("p",{class:"text-gray-500 text-sm"},"Email",-1)),s("p",Ee,c(e.user.email),1)]),s("div",null,[t[9]||(t[9]=s("p",{class:"text-gray-500 text-sm"},"Role",-1)),s("span",Fe,c(e.userRole),1)]),s("div",null,[t[10]||(t[10]=s("p",{class:"text-gray-500 text-sm"},"Assigned Tenant",-1)),s("p",Ve,[s("span",{class:S(["px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full",e.displayTenantName?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},c(e.displayTenantName||"Not Assigned"),3)])]),e.displayTenantName&&e.displayAssignedDate?(i(),d("div",ze,[t[11]||(t[11]=s("p",{class:"text-gray-500 text-sm"},"Assigned Date",-1)),s("p",Oe,[s("span",Qe,c(e.displayAssignedDate),1)])])):w("",!0),e.displayTenantName&&e.displayReassignmentDate?(i(),d("div",qe,[t[12]||(t[12]=s("p",{class:"text-gray-500 text-sm"},"Re-assigned Date",-1)),s("p",He,[s("span",Pe,c(e.displayReassignmentDate),1)])])):w("",!0)])]),e.canAssignTenants?(i(),O(n,{key:1,"user-id":e.userId,onAssign:e.assignTenantHandler,onCancel:e.goBack},null,8,["user-id","onAssign","onCancel"])):(i(),d("div",Ke,[...t[14]||(t[14]=[s("p",{class:"text-yellow-800"}," Tenant assignment is only available for Standard User and Monitoring User roles. ",-1)])]))]))])])])}const Xe=L(Te,[["render",Ge]]);export{Xe as default};
