import{_ as I,e as P,r as a,s as q,h as c,i as e,x as V,j as b,t as i,p as T,z as m,C as p,Q as N,w as D,P as A,J as d,R as w,F as L,l as z,L as J,o as r,n as O}from"./index-CJ_E5GLL.js";import{s as v}from"./superadmin.service-B8FsT-jF.js";const Q={class:"bg-white rounded-xl shadow-sm border border-gray-200"},Y={class:"p-6"},G={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},H={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},K={class:"text-lg font-medium text-gray-900 mb-4"},W={class:"flex items-center justify-between py-2"},X={class:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"},Z={key:0,class:"flex items-center justify-between py-2"},ee={class:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"},te={class:"flex justify-end space-x-3 pt-3"},se={class:"lg:col-span-2"},le={class:"bg-white rounded-xl shadow-sm border border-gray-200"},oe={class:"p-4 border-b border-gray-200 flex justify-between items-center"},ae={class:"text-xs px-2 py-1 bg-indigo-100 text-indigo-800 rounded-full"},re={class:"overflow-hidden"},ne={class:"min-w-full divide-y divide-gray-200"},ie={class:"bg-white divide-y divide-gray-200"},de={key:0,class:"animate-pulse"},ue={key:1},ce={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},pe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ve={class:"relative inline-block w-10 mr-2 align-middle select-none"},fe=["id","checked","onChange","disabled"],ye=["for"],xe={class:"text-xs ml-1"},be={class:"flex justify-end space-x-3"},we={__name:"RoleManagement",setup(he){const{success:f,error:g}=P(),y=a([]),F=a(!1),h=a(!1),_=a(!1),u=a(!1),S=a(null),x=a(!1),k=a(null),o=a({role_name:"",description:"",can_register_publicly:!0,status:"active"}),n=a({});q(async()=>{await R()});const R=async()=>{try{const s=await v.getRoles();console.log("Service: Roles response:",s),s.success&&Array.isArray(s.data)?y.value=s.data:(console.error("API Error fetching roles:",s.message),g(s.message||"Failed to fetch roles."))}catch(s){console.error("Error fetching roles:",s),g("A network error occurred. Please try again.")}},M=()=>(n.value={},o.value.role_name.trim()||(n.value.role_name="Role name is required"),o.value.description.trim()||(n.value.description="Description is required"),Object.keys(n.value).length===0),$=async()=>{if(M()){h.value=!0;try{if(u.value){const s=await v.updateRole(S.value,o.value);if(s.success)f("Role updated successfully");else throw new Error(s.message)}else{const s=await v.createRole(o.value);if(s.success)f("Role created successfully");else throw new Error(s.message)}E(),await R()}catch(s){console.error("Error saving role:",s),g(s.message||"Failed to save role")}finally{h.value=!1}}},j=async s=>{try{const l=s.status==="active"?"inactive":"active",C=await v.updateRole(s.id,{status:l});if(C.success)s.status=l,f(`Role status updated to ${l}`);else throw new Error(C.message)}catch(t){console.error("Error toggling role status:",t),g("Failed to update role status")}},U=()=>{u.value=!1,S.value=null,E()},B=async()=>{if(k.value){_.value=!0;try{const s=await v.deleteRole(k.value);if(s.success)f("Role deleted successfully");else throw new Error(s.message);x.value=!1,k.value=null,await R()}catch(s){console.error("Error deleting role:",s),g(s.message||"Failed to delete role")}finally{_.value=!1}}},E=()=>{o.value={role_name:"",description:"",can_register_publicly:!0,is_active:!0},n.value={}};return(s,t)=>(r(),c("div",Q,[t[21]||(t[21]=e("div",{class:"p-6 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900 font-roboto"},"User Role Management"),e("p",{class:"text-sm text-gray-600 mt-1"},"Create and manage user roles")],-1)),e("div",Y,[e("div",G,[e("div",H,[e("h4",K,i(u.value?"Edit Role":"Create New Role"),1),e("form",{onSubmit:T($,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"roleName",class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Role Name "),e("span",{class:"text-red-500"},"*")],-1)),m(N,{id:"roleName",modelValue:o.value.role_name,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.role_name=l),type:"text",placeholder:"Enter role name",error:n.value.role_name,required:""},null,8,["modelValue","error"])]),e("div",null,[t[7]||(t[7]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Description "),e("span",{class:"text-red-500"},"*")],-1)),m(N,{id:"description",modelValue:o.value.description,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.description=l),type:"text",placeholder:"Enter role description",error:n.value.description,required:""},null,8,["modelValue","error"])]),e("div",W,[t[9]||(t[9]=e("label",{for:"canRegister",class:"text-sm font-medium text-gray-700"}," Allow Public Registration ",-1)),e("div",X,[D(e("input",{type:"checkbox",id:"canRegister","onUpdate:modelValue":t[2]||(t[2]=l=>o.value.can_register_publicly=l),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"},null,512),[[A,o.value.can_register_publicly]]),t[8]||(t[8]=e("label",{for:"canRegister",class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,-1))])]),u.value?(r(),c("div",Z,[t[11]||(t[11]=e("label",{for:"roleStatus",class:"text-sm font-medium text-gray-700"}," Role Status ",-1)),e("div",ee,[D(e("input",{type:"checkbox",id:"roleStatus","onUpdate:modelValue":t[3]||(t[3]=l=>s.roleStatusComputed=l),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"},null,512),[[A,s.roleStatusComputed]]),t[10]||(t[10]=e("label",{for:"roleStatus",class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,-1))])])):b("",!0),e("div",te,[u.value?(r(),V(w,{key:0,type:"button",variant:"secondary",onClick:U},{default:d(()=>[...t[12]||(t[12]=[p(" Cancel ",-1)])]),_:1})):b("",!0),m(w,{type:"submit",variant:"primary",loading:h.value},{default:d(()=>[p(i(u.value?"Update Role":"Create Role"),1)]),_:1},8,["loading"])])],32)]),e("div",se,[e("div",le,[e("div",oe,[t[13]||(t[13]=e("h4",{class:"font-medium text-gray-900"},"Available Roles",-1)),e("span",ae,i(y.value.length)+" Roles ",1)]),e("div",re,[e("table",ne,[t[16]||(t[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Role Name "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Description "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Public Reg. "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ")])],-1)),e("tbody",ie,[F.value?(r(),c("tr",de,[...t[14]||(t[14]=[e("td",{colspan:"5",class:"px-6 py-4"},[e("div",{class:"h-4 bg-gray-200 rounded w-3/4"})],-1)])])):y.value.length===0?(r(),c("tr",ue,[...t[15]||(t[15]=[e("td",{colspan:"5",class:"px-6 py-4 text-center text-sm text-gray-500"}," No roles found. Create your first role. ",-1)])])):b("",!0),(r(!0),c(L,null,z(y.value,l=>(r(),c("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",ce,i(l.role_name),1),e("td",pe,i(l.description),1),e("td",ge,[e("span",{class:O(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",l.can_register_publicly?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},i(l.can_register_publicly?"Yes":"No"),3)]),e("td",me,[e("div",ve,[e("input",{type:"checkbox",id:`toggle-${l.id}`,checked:l.status==="active",onChange:C=>j(l),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer",disabled:["superadmin","templeadmin","devotee","volunteer"].includes(l.role_name)},null,40,fe),e("label",{for:`toggle-${l.id}`,class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,8,ye)]),e("span",xe,i(l.status==="active"?"Active":"Inactive"),1)])]))),128))])])])])])])]),x.value?(r(),V(J,{key:0,onClose:t[5]||(t[5]=l=>x.value=!1)},{header:d(()=>[...t[17]||(t[17]=[e("h3",{class:"text-lg font-medium text-gray-900"},"Confirm Delete",-1)])]),default:d(()=>[...t[18]||(t[18]=[e("div",{class:"py-4"},[e("p",{class:"text-gray-600"},"Are you sure you want to delete this role? This action cannot be undone.")],-1)])]),footer:d(()=>[e("div",be,[m(w,{onClick:t[4]||(t[4]=l=>x.value=!1),variant:"secondary"},{default:d(()=>[...t[19]||(t[19]=[p(" Cancel ",-1)])]),_:1}),m(w,{onClick:B,variant:"danger",loading:_.value},{default:d(()=>[...t[20]||(t[20]=[p(" Delete ",-1)])]),_:1},8,["loading"])])]),_:1})):b("",!0)]))}},Re=I(we,[["__scopeId","data-v-1d5834cf"]]);export{Re as default};
