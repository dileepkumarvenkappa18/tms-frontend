import{_ as L,e as q,r as a,c as O,s as z,h as p,i as e,x as N,j as b,t as i,p as J,z as m,C as g,Q as A,w as F,P as M,J as d,R as w,F as Q,l as Y,L as G,o as r,n as H}from"./index-CSzH4brs.js";import{s as v}from"./superadmin.service-BkJLvc6W.js";const K={class:"bg-white rounded-xl shadow-sm border border-gray-200"},W={class:"p-6"},X={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Z={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ee={class:"text-lg font-medium text-gray-900 mb-4"},te={class:"flex items-center justify-between py-2"},se={class:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"},oe={key:0,class:"flex items-center justify-between py-2"},le={class:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"},ae={class:"flex justify-end space-x-3 pt-3"},re={class:"lg:col-span-2"},ne={class:"bg-white rounded-xl shadow-sm border border-gray-200"},ie={class:"p-4 border-b border-gray-200 flex justify-between items-center"},de={class:"text-xs px-2 py-1 bg-indigo-100 text-indigo-800 rounded-full"},ue={class:"overflow-hidden"},ce={class:"min-w-full divide-y divide-gray-200"},pe={class:"bg-white divide-y divide-gray-200"},ge={key:0,class:"animate-pulse"},me={key:1},ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"relative inline-block w-10 mr-2 align-middle select-none"},we=["id","checked","onChange","disabled"],he=["for"],_e={class:"text-xs ml-1"},ke={class:"flex justify-end space-x-3"},Re={__name:"RoleManagement",setup(Ce){const{success:f,error:u}=q(),$=["superadmin","templeadmin","devotee","volunteer","standarduser","monitoringuser"],y=a([]),j=a(!1),h=a(!1),_=a(!1),c=a(!1),E=a(null),x=a(!1),k=a(null),l=a({role_name:"",description:"",can_register_publicly:!0,status:"active"}),n=a({}),S=O({get:()=>l.value.status==="active",set:s=>{l.value.status=s?"active":"inactive"}}),V=s=>$.includes(s.toLowerCase());z(async()=>{await R()});const R=async()=>{try{const s=await v.getRoles();console.log("Service: Roles response:",s),s.success&&Array.isArray(s.data)?y.value=s.data:(console.error("API Error fetching roles:",s.message),u(s.message||"Failed to fetch roles."))}catch(s){console.error("Error fetching roles:",s),u("A network error occurred. Please try again.")}},P=()=>(n.value={},l.value.role_name.trim()||(n.value.role_name="Role name is required"),l.value.description.trim()||(n.value.description="Description is required"),Object.keys(n.value).length===0),T=async()=>{if(P()){h.value=!0;try{if(c.value){const s=await v.updateRole(E.value,l.value);if(s.success)f("Role updated successfully");else throw new Error(s.message)}else{const s=await v.createRole(l.value);if(s.success)f("Role created successfully");else throw new Error(s.message)}D(),await R()}catch(s){console.error("Error saving role:",s),u(s.message||"Failed to save role")}finally{h.value=!1}}},U=async s=>{if(V(s.role_name)){u("Cannot modify protected system roles");return}try{const o=s.status==="active"?"inactive":"active",C=await v.updateRole(s.id,{status:o});if(C.success)s.status=o,f(`Role status updated to ${o}`);else throw new Error(C.message)}catch(t){console.error("Error toggling role status:",t),u("Failed to update role status")}},B=()=>{c.value=!1,E.value=null,D()},I=async()=>{if(k.value){_.value=!0;try{const s=await v.deleteRole(k.value);if(s.success)f("Role deleted successfully");else throw new Error(s.message);x.value=!1,k.value=null,await R()}catch(s){console.error("Error deleting role:",s),u(s.message||"Failed to delete role")}finally{_.value=!1}}},D=()=>{l.value={role_name:"",description:"",can_register_publicly:!0,status:"active"},n.value={}};return(s,t)=>(r(),p("div",K,[t[21]||(t[21]=e("div",{class:"p-6 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900 font-roboto"},"User Role Management"),e("p",{class:"text-sm text-gray-600 mt-1"},"Create and manage user roles")],-1)),e("div",W,[e("div",X,[e("div",Z,[e("h4",ee,i(c.value?"Edit Role":"Create New Role"),1),e("form",{onSubmit:J(T,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"roleName",class:"block text-sm font-medium text-gray-700 mb-2"},[g(" Role Name "),e("span",{class:"text-red-500"},"*")],-1)),m(A,{id:"roleName",modelValue:l.value.role_name,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.role_name=o),type:"text",placeholder:"Enter role name",error:n.value.role_name,required:""},null,8,["modelValue","error"])]),e("div",null,[t[7]||(t[7]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"},[g(" Description "),e("span",{class:"text-red-500"},"*")],-1)),m(A,{id:"description",modelValue:l.value.description,"onUpdate:modelValue":t[1]||(t[1]=o=>l.value.description=o),type:"text",placeholder:"Enter role description",error:n.value.description,required:""},null,8,["modelValue","error"])]),e("div",te,[t[9]||(t[9]=e("label",{for:"canRegister",class:"text-sm font-medium text-gray-700"}," Allow Public Registration ",-1)),e("div",se,[F(e("input",{type:"checkbox",id:"canRegister","onUpdate:modelValue":t[2]||(t[2]=o=>l.value.can_register_publicly=o),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"},null,512),[[M,l.value.can_register_publicly]]),t[8]||(t[8]=e("label",{for:"canRegister",class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,-1))])]),c.value?(r(),p("div",oe,[t[11]||(t[11]=e("label",{for:"roleStatus",class:"text-sm font-medium text-gray-700"}," Role Status ",-1)),e("div",le,[F(e("input",{type:"checkbox",id:"roleStatus","onUpdate:modelValue":t[3]||(t[3]=o=>S.value=o),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"},null,512),[[M,S.value]]),t[10]||(t[10]=e("label",{for:"roleStatus",class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,-1))])])):b("",!0),e("div",ae,[c.value?(r(),N(w,{key:0,type:"button",variant:"secondary",onClick:B},{default:d(()=>[...t[12]||(t[12]=[g(" Cancel ",-1)])]),_:1})):b("",!0),m(w,{type:"submit",variant:"primary",loading:h.value},{default:d(()=>[g(i(c.value?"Update Role":"Create Role"),1)]),_:1},8,["loading"])])],32)]),e("div",re,[e("div",ne,[e("div",ie,[t[13]||(t[13]=e("h4",{class:"font-medium text-gray-900"},"Available Roles",-1)),e("span",de,i(y.value.length)+" Roles ",1)]),e("div",ue,[e("table",ce,[t[16]||(t[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Role Name "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Description "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Public Reg. "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ")])],-1)),e("tbody",pe,[j.value?(r(),p("tr",ge,[...t[14]||(t[14]=[e("td",{colspan:"4",class:"px-6 py-4"},[e("div",{class:"h-4 bg-gray-200 rounded w-3/4"})],-1)])])):y.value.length===0?(r(),p("tr",me,[...t[15]||(t[15]=[e("td",{colspan:"4",class:"px-6 py-4 text-center text-sm text-gray-500"}," No roles found. Create your first role. ",-1)])])):b("",!0),(r(!0),p(Q,null,Y(y.value,o=>(r(),p("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",ve,i(o.role_name),1),e("td",fe,i(o.description),1),e("td",ye,[e("span",{class:H(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",o.can_register_publicly?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},i(o.can_register_publicly?"Yes":"No"),3)]),e("td",xe,[e("div",be,[e("input",{type:"checkbox",id:`toggle-${o.id}`,checked:o.status==="active",onChange:C=>U(o),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer",disabled:V(o.role_name)},null,40,we),e("label",{for:`toggle-${o.id}`,class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,8,he)]),e("span",_e,i(o.status==="active"?"Active":"Inactive"),1)])]))),128))])])])])])])]),x.value?(r(),N(G,{key:0,onClose:t[5]||(t[5]=o=>x.value=!1)},{header:d(()=>[...t[17]||(t[17]=[e("h3",{class:"text-lg font-medium text-gray-900"},"Confirm Delete",-1)])]),default:d(()=>[...t[18]||(t[18]=[e("div",{class:"py-4"},[e("p",{class:"text-gray-600"},"Are you sure you want to delete this role? This action cannot be undone.")],-1)])]),footer:d(()=>[e("div",ke,[m(w,{onClick:t[4]||(t[4]=o=>x.value=!1),variant:"secondary"},{default:d(()=>[...t[19]||(t[19]=[g(" Cancel ",-1)])]),_:1}),m(w,{onClick:I,variant:"danger",loading:_.value},{default:d(()=>[...t[20]||(t[20]=[g(" Delete ",-1)])]),_:1},8,["loading"])])]),_:1})):b("",!0)]))}},Ve=L(Re,[["__scopeId","data-v-74e03af8"]]);export{Ve as default};
