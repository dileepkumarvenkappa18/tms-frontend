import{r as x,c as G,s as re,h as c,B as N,i as s,j as J,t as g,w as K,v as ie,k as ae,y as W,F as A,l as $,C as L,e as ne,A as de,o as p,n as T}from"./index-DBwbCPCQ.js";import{u as ce}from"./superadmin-CNKF4_6H.js";import{s as X}from"./superadmin.service-BupbF8UL.js";const pe={class:"min-h-screen bg-gray-50"},me={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ue={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden mb-8"},ge={class:"p-6"},fe={class:"mb-6"},ve={class:"flex items-center justify-between mb-4"},xe={class:"flex space-x-3"},ye=["disabled"],he={class:"flex flex-wrap items-center gap-4 mb-4"},be={class:"relative flex-1 min-w-[250px]"},we={class:"relative"},_e={key:0,class:"mb-4 bg-red-50 border border-red-200 rounded-lg p-4"},Te={class:"flex items-start"},ke={class:"ml-3"},Ce={class:"text-sm text-red-800"},Se={key:1,class:"py-10 flex justify-center"},Ne={key:2,class:"text-center py-8"},Ae={key:3,class:"text-center py-8"},$e={key:4,class:"overflow-x-auto border border-gray-200 rounded-lg"},Le={class:"min-w-full divide-y divide-gray-200"},Me={class:"bg-white divide-y divide-gray-200"},Re={class:"px-6 py-4 whitespace-nowrap"},je=["checked","onChange"],Ie={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},De={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Pe={class:"px-6 py-4 whitespace-nowrap"},ze={class:"mt-8 border-t border-gray-200 pt-6"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Be=["onClick"],He={class:"flex items-start"},Ee={class:"flex-shrink-0"},qe=["d"],Ue={class:"ml-4"},Oe={class:"text-base font-medium text-gray-900"},Qe={class:"mt-1 text-sm text-gray-500"},Ge={class:"mt-8 flex justify-end"},Je=["disabled"],Ke={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"},We={class:"p-6"},Xe={class:"flex flex-wrap gap-2 mb-4"},Ye={class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},Ze={class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},et={key:0,class:"mt-4"},tt={class:"flex flex-wrap gap-2"},st=["onClick"],at={__name:"SuperadminReportsView",setup(ot){const Y=de(),r=ce(),M=ne(),y=x(!1),w=x(""),h=x("all"),m=x([]),_=x(""),k=x(""),C=[{id:"temple-register",name:"Temple Register Report",description:"View temple registration data for selected tenant",icon:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",bgColor:"bg-blue-100",iconColor:"text-blue-600",route:"/superadmin/reports/temple-register"},{id:"temple-activities",name:"Temple Activities Report",description:"Track events, seva, and other temple activities",icon:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2",bgColor:"bg-green-100",iconColor:"text-green-600",route:"/superadmin/reports/temple-activities"},{id:"birthdays",name:"Devotee Reports",description:"View devotee birthdays, lists, and profiles",icon:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z",bgColor:"bg-purple-100",iconColor:"text-purple-600",route:"/superadmin/reports/birthdays"}],d=x({}),R=G(()=>{if(!r.tenants||!Array.isArray(r.tenants))return[];let e=r.tenants;if(w.value){const t=w.value.toLowerCase();e=e.filter(o=>{var i,a,l;return((i=o.name)==null?void 0:i.toLowerCase().includes(t))||((a=o.fullName)==null?void 0:a.toLowerCase().includes(t))||((l=o.FullName)==null?void 0:l.toLowerCase().includes(t))||I(o).toLowerCase().includes(t)||D(o).toLowerCase().includes(t)})}return h.value!=="all"&&(e=e.filter(t=>{var o,i;return((o=t.status)==null?void 0:o.toLowerCase())===h.value.toLowerCase()||((i=t.Status)==null?void 0:i.toLowerCase())===h.value.toLowerCase()})),e}),j=G(()=>m.value.length>0&&_.value),u=e=>{let t=null;return e.id!==void 0?t=e.id:e.ID!==void 0?t=e.ID:e.tenant_id!==void 0?t=e.tenant_id:e.tenantId!==void 0?t=e.tenantId:e.userId!==void 0?t=e.userId:e.user_id!==void 0&&(t=e.user_id),v(t)},v=e=>{if(e==null)return null;if(typeof e=="number")return e;if(typeof e=="string"){const t=e.replace(/[^0-9]/g,"");if(t&&!isNaN(parseInt(t,10)))return parseInt(t,10)}return e},S=e=>e.fullName||e.FullName||e.name||e.Name||`Tenant #${u(e)}`,I=e=>{var o,i,a,l,f,n;const t=u(e);return(o=e.temple_details)!=null&&o.temple_name?e.temple_details.temple_name:(i=d.value[t])!=null&&i.name?d.value[t].name:(a=e.temple)!=null&&a.name?e.temple.name:(l=e.temple)!=null&&l.Name?e.temple.Name:(f=e.Temple)!=null&&f.name?e.Temple.name:(n=e.Temple)!=null&&n.Name?e.Temple.Name:e.templeName?e.templeName:e.TemplateName?e.TemplateName:`${S(e)}'s Temple`},D=e=>{var o,i,a,l,f,n,E,q,U,O,Q;const t=u(e);if((o=e.temple_details)!=null&&o.temple_place)return e.temple_details.temple_place;if(d.value[t]){const b=d.value[t];if(b.city&&b.state)return`${b.city}, ${b.state}`;if(b.address)return b.address}return(i=e.temple)!=null&&i.city&&((a=e.temple)!=null&&a.state)?`${e.temple.city}, ${e.temple.state}`:(l=e.Temple)!=null&&l.City&&((f=e.Temple)!=null&&f.State)?`${e.Temple.City}, ${e.Temple.State}`:(n=e.temple)!=null&&n.location?e.temple.location:(E=e.Temple)!=null&&E.Location?e.Temple.Location:(q=e.temple)!=null&&q.place?e.temple.place:(U=e.Temple)!=null&&U.Place?e.Temple.Place:(O=e.temple)!=null&&O.address?e.temple.address:(Q=e.Temple)!=null&&Q.Address?e.Temple.Address:e.location?e.location:e.Location?e.Location:e.city&&e.state?`${e.city}, ${e.state}`:e.City&&e.State?`${e.City}, ${e.State}`:e.address?e.address:e.Address?e.Address:e.place?e.place:e.Place?e.Place:"Location not available"},F=async()=>{y.value=!0,k.value="";try{console.log("Starting tenant fetch...");const e=await r.fetchTenantsForReports();if(console.log("Store fetchTenantsForReports response:",e),e&&e.success&&r.tenants&&Array.isArray(r.tenants)&&r.tenants.length>0)console.log("Successfully loaded tenants via store:",r.tenants.length),P(),await z();else if(console.log("Store method failed, trying basic fetchTenants..."),await r.fetchTenants(),r.tenants&&Array.isArray(r.tenants)&&r.tenants.length>0)console.log("Basic fetch successful:",r.tenants.length),P(),await z();else throw new Error("No tenants found in store after fetch attempts")}catch(e){console.error("Error fetching tenants:",e),k.value=`Failed to load tenants: ${e.message}`,r.tenants||(r.tenants=[]),M.error("Failed to load tenants. Please check console for details.")}finally{y.value=!1}},P=()=>{!r.tenants||!Array.isArray(r.tenants)||(r.tenants.length>0&&console.log("First tenant object:",r.tenants[0]),r.tenants.forEach(e=>{var o,i;const t=u(e);if(t===null){console.warn("Tenant has no valid ID:",e);return}e.temple_details?d.value[t]={name:e.temple_details.temple_name||"",city:e.temple_details.temple_place?(o=e.temple_details.temple_place.split(",")[0])==null?void 0:o.trim():"",state:e.temple_details.temple_place?(i=e.temple_details.temple_place.split(",")[1])==null?void 0:i.trim():"",address:e.temple_details.temple_address||""}:e.temple?d.value[t]={name:e.temple.name||e.temple.Name||"",city:e.temple.city||e.temple.City||"",state:e.temple.state||e.temple.State||"",address:e.temple.address||e.temple.Address||""}:e.Temple&&(d.value[t]={name:e.Temple.name||e.Temple.Name||"",city:e.Temple.city||e.Temple.City||"",state:e.Temple.state||e.Temple.State||"",address:e.Temple.address||e.Temple.Address||""})}),console.log(`Processed ${Object.keys(d.value).length} temple data entries`))},z=async()=>{if(!r.tenants||!Array.isArray(r.tenants))return;const e=r.tenants.filter(o=>{const i=u(o);return i!==null&&!o.temple&&!o.Temple&&!o.temple_details&&!d.value[i]});if(e.length===0){console.log("All tenants already have temple details");return}console.log(`Fetching temple details for ${e.length} tenants...`);const t=5;for(let o=0;o<e.length;o+=t){const i=e.slice(o,o+t);await Promise.all(i.map(async a=>{try{const l=u(a);if(l===null)return;if(typeof X.getTenantDetails=="function"){const f=await X.getTenantDetails(l);if(f&&f.success&&f.data){const n=f.data;d.value[l]={name:n.temple_name||n.templeName||n.TempleName||"",city:n.temple_place||n.templePlace||n.TemplePlace||"",state:n.temple_state||n.templeState||n.TempleState||"",address:n.temple_address||n.templeAddress||n.TempleAddress||""},a.temple_details={temple_name:d.value[l].name,temple_place:d.value[l].city+(d.value[l].state?", "+d.value[l].state:""),temple_address:d.value[l].address},console.log(`Updated temple details for tenant ${l}`)}}}catch(l){console.warn("Failed to fetch temple details for tenant:",l)}})),o+t<e.length&&await new Promise(a=>setTimeout(a,500))}console.log(`Completed fetching temple details. Temple map has ${Object.keys(d.value).length} entries.`)},V=e=>{if(e==null)return!1;const t=v(e);return m.value.some(o=>v(o)===t)},B=e=>{if(e==null){console.warn("Attempted to toggle selection with null/undefined ID");return}const t=v(e),o=m.value.findIndex(i=>v(i)===t);o===-1?(m.value.push(t),console.log(`Added tenant ${t} to selection, now have ${m.value.length} selected`)):(m.value.splice(o,1),console.log(`Removed tenant ${t} from selection, now have ${m.value.length} selected`))},Z=()=>{w.value="",h.value="all"},ee=e=>{_.value=e,console.log("Selected report:",e)},H=async()=>{console.log("Retrying tenant fetch..."),await F()},te=e=>({approved:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",rejected:"bg-red-100 text-red-800",active:"bg-green-100 text-green-800"})[e==null?void 0:e.toLowerCase()]||"bg-gray-100 text-gray-800",se=e=>{if(!r.tenants||!Array.isArray(r.tenants))return`Tenant #${e}`;const t=v(e),o=r.tenants.find(i=>v(u(i))===t);return o?S(o):`Tenant #${e}`},oe=()=>{const e=C.find(t=>t.id===_.value);return e?e.name:"None Selected"},le=()=>{if(!j.value)return;const e=C.find(l=>l.id===_.value);if(!e)return;console.log("Selected tenant IDs before processing:",m.value);const t=m.value.map(l=>v(l)).filter(l=>l!==null);console.log("Processed tenant IDs:",t);const o=t.filter(l=>typeof l=="number"),i=t.filter(l=>typeof l=="string");console.log(`ID types: ${o.length} numeric, ${i.length} string`);const a=t.join(",");if(console.log("Final tenants parameter string:",a),!a){M.error("No valid tenant IDs to include in report");return}Y.push({path:e.route,query:{tenants:a,from:"superadmin"}}),console.log("Navigating to:",`${e.route}?tenants=${a}&from=superadmin`)};return re(async()=>{console.log("Component mounted, fetching tenants..."),await F()}),(e,t)=>(p(),c("div",pe,[t[19]||(t[19]=N('<div class="bg-white shadow-sm border-b border-gray-200 rounded-2xl"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"><div class="flex items-center justify-between"><div><h1 class="text-2xl font-bold text-gray-900">Reports Management</h1><p class="text-gray-600 mt-1"> Select tenant to generate reports </p></div><div class="flex items-center space-x-4"><div class="bg-indigo-50 px-4 py-2 rounded-lg border border-indigo-200"><span class="text-indigo-800 font-medium">Super Admin</span></div></div></div></div></div>',1)),s("div",me,[s("div",ue,[t[12]||(t[12]=s("div",{class:"p-6 border-b border-gray-200"},[s("div",{class:"flex items-center justify-between"},[s("div",null,[s("h3",{class:"text-xl font-bold text-gray-900"},"Select Tenant"),s("p",{class:"text-gray-600 mt-1"},"Choose tenant")])])],-1)),s("div",ge,[s("div",fe,[s("div",ve,[t[2]||(t[2]=s("div",null,[s("h4",{class:"text-lg font-medium text-gray-900"},"Tenant Selection")],-1)),s("div",xe,[s("button",{onClick:H,class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium",disabled:y.value},g(y.value?"Loading...":"Retry Load"),9,ye)])]),s("div",he,[s("div",be,[K(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>w.value=o),placeholder:"Search tenants...",type:"search",class:"w-full border border-gray-300 rounded-lg py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[ie,w.value]]),t[3]||(t[3]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",we,[K(s("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>h.value=o),class:"border border-gray-300 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white"},[...t[4]||(t[4]=[N('<option value="all">All Status</option><option value="approved">Approved</option><option value="pending">Pending</option><option value="rejected">Rejected</option><option value="active">Active</option>',5)])],512),[[ae,h.value]])])]),k.value&&!y.value?(p(),c("div",_e,[s("div",Te,[t[5]||(t[5]=s("svg",{class:"h-5 w-5 text-red-400 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),s("div",ke,[s("p",Ce,g(k.value),1),s("button",{onClick:H,class:"mt-2 text-sm text-red-600 hover:text-red-800 font-medium"}," Try Again ")])])])):J("",!0),y.value?(p(),c("div",Se,[...t[6]||(t[6]=[s("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"},null,-1)])])):!W(r).tenants||W(r).tenants.length===0?(p(),c("div",Ne,[...t[7]||(t[7]=[N('<div class="text-gray-400 mb-4"><svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg></div><p class="text-gray-500 text-lg">No tenants available</p><p class="text-gray-400 text-sm mt-2">Click &quot;Retry Load&quot; to fetch tenant data</p>',3)])])):R.value.length===0?(p(),c("div",Ae,[t[8]||(t[8]=s("div",{class:"text-gray-400 mb-4"},[s("svg",{class:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),t[9]||(t[9]=s("p",{class:"text-gray-500"},"No tenants found matching your filters",-1)),s("button",{onClick:Z,class:"mt-2 text-indigo-600 hover:text-indigo-800 text-sm font-medium"}," Clear Filters ")])):(p(),c("div",$e,[s("table",Le,[t[10]||(t[10]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[s("div",{class:"flex items-center"}," Select ")]),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tenant Name"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Temple Name"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Location"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status")])],-1)),s("tbody",Me,[(p(!0),c(A,null,$(R.value,o=>(p(),c("tr",{key:u(o),class:T({"bg-indigo-50":V(u(o))})},[s("td",Re,[s("input",{type:"radio",checked:V(u(o)),onChange:i=>B(u(o)),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,40,je)]),s("td",Ie,g(S(o)),1),s("td",De,g(I(o)),1),s("td",Fe,g(D(o)),1),s("td",Pe,[s("span",{class:T(["px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full",te(o.status||o.Status)])},g(o.status||o.Status||"Unknown"),3)])],2))),128))])])]))]),s("div",ze,[t[11]||(t[11]=s("h4",{class:"text-lg font-medium text-gray-900 mb-4"},"Select Report Type",-1)),s("div",Ve,[(p(),c(A,null,$(C,o=>s("div",{key:o.id,onClick:i=>ee(o.id),class:T(["border p-4 rounded-lg cursor-pointer transition-colors",_.value===o.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-indigo-300 hover:bg-indigo-50/50"])},[s("div",He,[s("div",Ee,[s("div",{class:T(["h-10 w-10 flex items-center justify-center rounded-lg",o.bgColor])},[(p(),c("svg",{class:T(["h-6 w-6",o.iconColor]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o.icon},null,8,qe)],2))],2)]),s("div",Ue,[s("h5",Oe,g(o.name),1),s("p",Qe,g(o.description),1)])])],10,Be)),64))])]),s("div",Ge,[s("button",{onClick:le,disabled:!j.value,class:"px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Proceed to Report ",8,Je)])])]),s("div",Ke,[s("div",We,[t[17]||(t[17]=s("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Selection Summary",-1)),s("div",Xe,[s("div",Ye,[t[13]||(t[13]=s("span",{class:"font-medium mr-1"},"Selected Tenant:",-1)),L(" "+g(m.value.length>0?"1":"0"),1)]),s("div",Ze,[t[14]||(t[14]=s("span",{class:"font-medium mr-1"},"Report Type:",-1)),L(" "+g(oe()),1)])]),m.value.length>0?(p(),c("div",et,[t[16]||(t[16]=s("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Selected Tenant:",-1)),s("div",tt,[(p(!0),c(A,null,$(m.value,o=>(p(),c("span",{key:o,class:"inline-flex items-center px-2.5 py-0.5 rounded-md text-sm bg-gray-100 text-gray-800"},[L(g(se(o))+" ",1),s("button",{onClick:i=>B(o),class:"ml-1.5 text-gray-500 hover:text-gray-700"},[...t[15]||(t[15]=[s("svg",{class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,st)]))),128))])])):J("",!0),t[18]||(t[18]=s("p",{class:"mt-4 text-sm text-gray-600"},' Select a tenant and a report type above, then click "Proceed to Report" to generate the report. ',-1))])])])]))}};export{at as default};
