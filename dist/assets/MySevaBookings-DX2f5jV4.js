import{H as G,r as v,c as A,E as Q,I as X,s as Z,h as c,i as t,z as b,j as h,t as n,J as D,C as U,y as T,K as ee,w as M,k as q,B as z,v as te,F as se,l as ae,n as Y,L as H,G as oe,M as le,e as ne,A as re,o as m}from"./index-CSzH4brs.js";const ie={class:"bg-white shadow-lg mb-6"},de={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},ue={class:"flex items-center justify-between"},ce={class:"flex items-center space-x-4"},me={class:"text-lg font-semibold text-gray-900"},ve={key:0,class:"text-sm text-gray-500"},pe={class:"flex items-center space-x-3"},ge={class:"text-right hidden sm:block"},fe={class:"text-gray-900 font-medium text-sm"},xe={class:"text-gray-500 text-xs"},ye={class:"bg-white p-6 rounded-xl shadow-sm mb-6"},he={class:"flex items-center justify-between"},we={class:"bg-white p-6 rounded-xl shadow-sm mb-6"},_e={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Se={class:"relative"},Ce={key:0,class:"bg-white p-6 rounded-xl shadow-sm flex justify-center"},ke={key:1,class:"bg-white p-6 rounded-xl shadow-sm flex justify-center"},be={class:"flex flex-col items-center text-center"},De={class:"mt-1 text-sm text-gray-500"},Te={key:2,class:"bg-white p-6 rounded-xl shadow-sm"},Be={class:"overflow-x-auto"},Ie={class:"min-w-full divide-y divide-gray-200"},Me={class:"bg-white divide-y divide-gray-200"},Ne={class:"px-6 py-4 whitespace-nowrap"},je={class:"flex items-center"},Ee={class:"ml-4"},Le={class:"text-sm font-medium text-gray-900"},Re={class:"text-xs text-gray-500"},Ve={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"text-sm text-gray-900"},$e={class:"text-xs text-gray-500"},Ae={class:"px-6 py-4 whitespace-nowrap"},Ue={class:"text-sm text-gray-900"},qe={class:"text-xs text-gray-500"},ze={class:"px-6 py-4 whitespace-nowrap"},Ye={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},He=["onClick"],Oe=["onClick"],Pe={key:3,class:"bg-white p-8 rounded-xl shadow-sm text-center"},Je={class:"mt-6"},Ke={key:0,class:"p-4"},We={class:"space-y-4"},Ge={class:"flex justify-between"},Qe={class:"text-lg font-medium text-gray-900"},Xe={class:"grid grid-cols-2 gap-4 text-sm"},Ze={class:"font-medium"},et={class:"font-medium"},tt={class:"font-medium"},st={class:"font-medium"},at={class:"font-medium"},ot={class:"font-medium"},lt={class:"col-span-2"},nt={class:"font-medium"},rt={key:0,class:"col-span-2"},it={class:"font-medium"},dt={class:"mt-6 flex justify-end space-x-3"},ut={class:"p-4"},ct={class:"mt-6 flex justify-end space-x-3"},pt={__name:"MySevaBookings",setup(mt){const w=Q();re();const r=G(),N=ne(),B=v(!1),_=v(null),u=v({status:"all",dateRange:"all",search:""}),o=v(null),f=v(!1),x=v(!1),d=v({name:"",city:"",state:""}),p=v({name:"",email:""}),g=A(()=>w.params.id),j=async()=>{var s;try{console.log("Fetching temple information...");const e=localStorage.getItem("selectedTempleName");e&&(d.value.name=e,console.log("Temple name from localStorage:",e));const l=g.value||localStorage.getItem("selectedEntityId")||localStorage.getItem("current_entity_id")||localStorage.getItem("current_tenant_id");if(!l){console.warn("No entity ID found");return}console.log("Fetching temple details for entity ID:",l);try{const a=await oe.get(`/entities/${l}`);console.log("Temple API response:",a);const i=((s=a.data)==null?void 0:s.data)||a.data||a;i&&(d.value={name:i.name||i.Name||e||"Temple",city:i.city||i.City||"",state:i.state||i.State||""},d.value.name&&localStorage.setItem("selectedTempleName",d.value.name),console.log("Temple info loaded:",d.value))}catch(a){console.warn("API fetch failed, using localStorage data:",a),d.value.name=e||"Temple"}}catch(e){console.error("Error fetching temple info:",e),d.value.name=localStorage.getItem("selectedTempleName")||"Temple"}},O=()=>{try{const s=localStorage.getItem("user_name")||localStorage.getItem("userName"),e=localStorage.getItem("user_email")||localStorage.getItem("userEmail");try{const l=localStorage.getItem("user_data");if(l){const a=JSON.parse(l);p.value={name:a.name||a.Name||s||"Devotee",email:a.email||a.Email||e||""};return}}catch(l){console.warn("Error parsing user_data:",l)}p.value={name:s||"Devotee",email:e||""},console.log("User info loaded:",p.value)}catch(s){console.error("Error fetching user info:",s),p.value={name:"Devotee",email:""}}},y=s=>{if(!s)return"";try{return new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}catch(e){return console.error("Error formatting date:",e),""}},S=s=>{if(!s)return"";try{return new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(e){return console.error("Error formatting time:",e),""}},E=s=>s?s.charAt(0).toUpperCase()+s.slice(1).toLowerCase():"Pending",L=s=>s.seva&&s.seva.date?y(s.seva.date):s.schedule_time||s.ScheduleTime?y(s.schedule_time||s.ScheduleTime):s.time_slot_date||s.TimeSlotDate?y(s.time_slot_date||s.TimeSlotDate):"Not scheduled",R=s=>{if(s.seva){if(s.seva.start_time&&s.seva.end_time)return`${s.seva.start_time} - ${s.seva.end_time}`;if(s.seva.start_time)return s.seva.start_time;if(s.seva.time)return s.seva.time}return s.schedule_time||s.ScheduleTime?S(s.schedule_time||s.ScheduleTime):s.time_slot||s.TimeSlot?s.time_slot||s.TimeSlot:s.time_slot_time||s.TimeSlotTime?S(s.time_slot_time||s.TimeSlotTime):"Not scheduled"},V=s=>s&&{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"}[s.toLowerCase()]||"bg-gray-100 text-gray-800",F=A(()=>{let s=r.recentSevas||[];if(console.log("All seva bookings before entity filtering:",s),console.log("Current entity ID:",g.value),s=s.filter(e=>{var i;const l=e.entity_id||e.EntityID||((i=e.seva)==null?void 0:i.entity_id),a=parseInt(g.value);return console.log(`Booking entity ID: ${l}, Current entity: ${a}`),parseInt(l)===a}),console.log("Bookings after entity filtering:",s),u.value.status!=="all"&&(s=s.filter(e=>(e.status||e.Status||"").toLowerCase()===u.value.status.toLowerCase())),u.value.dateRange!=="all"){const e=new Date,l=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(e);a.setDate(e.getDate()-e.getDay()),a.setHours(0,0,0,0);const i=new Date(e.getFullYear(),e.getMonth(),1),I=new Date(e.getFullYear(),0,1);s=s.filter($=>{const k=new Date($.booking_time||$.BookingTime||new Date);switch(u.value.dateRange){case"today":return k>=l;case"week":return k>=a;case"month":return k>=i;case"year":return k>=I;default:return!0}})}if(u.value.search){const e=u.value.search.toLowerCase();s=s.filter(l=>{const a=(l.seva_name||l.seva&&l.seva.name||"").toLowerCase(),i=(l.seva_type||l.seva&&l.seva.type||"").toLowerCase(),I=(l.special_requests||l.SpecialRequests||"").toLowerCase();return a.includes(e)||i.includes(e)||I.includes(e)})}return s}),C=async()=>{B.value=!0,_.value=null;try{console.log("Fetching seva bookings for entity:",g.value),await r.fetchSevas({entity_id:g.value}),console.log("Seva catalog fetched:",r.sevas),await r.fetchRecentSevas(g.value),console.log("Recent sevas before merge:",r.recentSevas),r.recentSevas&&r.recentSevas.length>0&&(r.recentSevas=r.recentSevas.map(s=>{const e=s.seva_id||s.SevaID;console.log("Looking for seva with ID:",e);const l=r.sevas.find(a=>(console.log("Comparing with seva:",a.id,a.ID),parseInt(a.id)===parseInt(e)||parseInt(a.ID)===parseInt(e)));return console.log("Found seva details:",l),l?{...s,seva:l,seva_name:s.seva_name||l.name,seva_type:s.seva_type||l.seva_type,seva_description:s.seva_description||l.description}:s})),console.log("Fetched seva bookings with seva details merged:",r.recentSevas)}catch(s){console.error("Error fetching seva bookings:",s),_.value=s.message||"Failed to load seva bookings"}finally{B.value=!1}},P=s=>{o.value=s,f.value=!0},J=s=>{o.value=s,x.value=!0},K=()=>{f.value=!1,x.value=!0},W=async()=>{try{const s=o.value.id||o.value.ID;await le.updateBookingStatus(s,"cancelled"),await C(),N.success("Seva booking cancelled successfully"),x.value=!1,f.value=!1}catch(s){console.error("Error cancelling booking:",s),N.error("Failed to cancel booking: "+(s.message||"Unknown error"))}};return X(()=>w.params.id,(s,e)=>{s&&s!==e&&(console.log("Entity changed from",e,"to",s),j(),C())}),Z(async()=>{console.log("SevaBookings component mounted"),O(),await j(),await C(),console.log("Final sevaStore state:",{recentSevas:r.recentSevas,sevaCatalog:r.sevaCatalog,loadingRecentSevas:r.loadingRecentSevas,loadingCatalog:r.loadingCatalog,currentEntityId:g.value,currentTemple:d.value,currentUser:p.value})}),(s,e)=>{const l=ee("router-link");return m(),c("div",null,[t("div",ie,[t("div",de,[t("div",ue,[t("div",ce,[e[7]||(e[7]=t("div",{class:"h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center"},[t("svg",{class:"h-6 w-6 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})])],-1)),t("div",null,[t("h2",me,n(d.value.name||"Loading Temple..."),1),d.value.city||d.value.state?(m(),c("p",ve,n(d.value.city)+n(d.value.city&&d.value.state?", ":"")+n(d.value.state),1)):h("",!0)])]),t("div",pe,[t("div",ge,[t("p",fe,n(p.value.name||"Devotee"),1),t("p",xe,n(p.value.email||""),1)]),e[8]||(e[8]=t("div",{class:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center"},[t("svg",{class:"w-6 h-6 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1))])])])]),t("div",ye,[t("div",he,[e[10]||(e[10]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900"},"My Seva Bookings"),t("p",{class:"text-gray-600 mt-1"},"View and manage all your seva bookings")],-1)),b(l,{to:`/entity/${T(w).params.id}/devotee/seva-booking`,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none"},{default:D(()=>[...e[9]||(e[9]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),U(" Book New Seva ",-1)])]),_:1},8,["to"])])]),t("div",we,[t("div",_e,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),M(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.status=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"},[...e[11]||(e[11]=[z('<option value="all">All Statuses</option><option value="pending">Pending</option><option value="approved">Approved</option><option value="completed">Completed</option><option value="cancelled">Cancelled</option>',5)])],512),[[q,u.value.status]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date Range",-1)),M(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.dateRange=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"},[...e[13]||(e[13]=[z('<option value="all">All Time</option><option value="today">Today</option><option value="week">This Week</option><option value="month">This Month</option><option value="year">This Year</option>',5)])],512),[[q,u.value.dateRange]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Search",-1)),t("div",Se,[M(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.search=a),type:"text",placeholder:"Search seva name...",class:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"},null,512),[[te,u.value.search]]),e[15]||(e[15]=t("svg",{class:"absolute left-3 top-2.5 h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])])])]),B.value||T(r).loadingRecentSevas||T(r).loadingCatalog?(m(),c("div",Ce,[...e[17]||(e[17]=[t("div",{class:"flex flex-col items-center"},[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"}),t("p",{class:"mt-2 text-gray-600"},"Loading your seva bookings...")],-1)])])):_.value?(m(),c("div",ke,[t("div",be,[e[18]||(e[18]=t("svg",{class:"h-10 w-10 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e[19]||(e[19]=t("h3",{class:"mt-2 text-lg font-medium text-gray-900"},"Error loading seva bookings",-1)),t("p",De,n(_.value),1),t("button",{onClick:C,class:"mt-3 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none"}," Try Again ")])])):F.value.length>0?(m(),c("div",Te,[t("div",Be,[t("table",Ie,[e[21]||(e[21]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Seva "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Seva Booked Date "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Seva Scheduled date "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),t("tbody",Me,[(m(!0),c(se,null,ae(F.value,a=>(m(),c("tr",{key:a.id||a.ID,class:"hover:bg-gray-50"},[t("td",Ne,[t("div",je,[e[20]||(e[20]=t("div",{class:"flex-shrink-0 h-10 w-10 bg-indigo-100 rounded-full flex items-center justify-center"},[t("svg",{class:"h-5 w-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 002 2z"})])],-1)),t("div",Ee,[t("div",Le,n(a.seva_name||a.seva&&a.seva.name||`Seva ${a.seva_id||a.SevaID||""}`),1),t("div",Re,n(a.seva_type||a.seva&&a.seva.type||""),1)])])]),t("td",Ve,[t("div",Fe,n(y(a.booking_time||a.BookingTime)),1),t("div",$e,n(S(a.booking_time||a.BookingTime)),1)]),t("td",Ae,[t("div",Ue,n(L(a)),1),t("div",qe,n(R(a)),1)]),t("td",ze,[t("span",{class:Y([V(a.status||a.Status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},n(E(a.status||a.Status)),3)]),t("td",Ye,[t("button",{onClick:i=>P(a),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," View ",8,He),(a.status||a.Status||"").toLowerCase()==="pending"?(m(),c("button",{key:0,onClick:i=>J(a),class:"text-red-600 hover:text-red-900"}," Cancel ",8,Oe)):h("",!0)])]))),128))])])])])):(m(),c("div",Pe,[e[23]||(e[23]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 002 2z"})],-1)),e[24]||(e[24]=t("h3",{class:"mt-2 text-lg font-medium text-gray-900"},"No seva bookings found",-1)),e[25]||(e[25]=t("p",{class:"mt-1 text-sm text-gray-500"},"You haven't booked any sevas yet for this temple.",-1)),t("div",Je,[b(l,{to:`/entity/${T(w).params.id}/devotee/seva-booking`,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none"},{default:D(()=>[...e[22]||(e[22]=[U(" Book Your First Seva ",-1)])]),_:1},8,["to"])])])),b(H,{show:f.value,onClose:e[4]||(e[4]=a=>f.value=!1),title:"Booking Details"},{default:D(()=>[o.value?(m(),c("div",Ke,[t("div",We,[t("div",Ge,[t("h3",Qe,n(o.value.seva_name||o.value.seva&&o.value.seva.name||`Seva ${o.value.seva_id||o.value.SevaID||""}`),1),t("span",{class:Y([V(o.value.status||o.value.Status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},n(E(o.value.status||o.value.Status)),3)]),t("div",Xe,[t("div",null,[e[26]||(e[26]=t("p",{class:"text-gray-500"},"Booking Date",-1)),t("p",Ze,n(y(o.value.booking_time||o.value.BookingTime)),1)]),t("div",null,[e[27]||(e[27]=t("p",{class:"text-gray-500"},"Booking Time",-1)),t("p",et,n(S(o.value.booking_time||o.value.BookingTime)),1)]),t("div",null,[e[28]||(e[28]=t("p",{class:"text-gray-500"},"Seva Schedule Date",-1)),t("p",tt,n(L(o.value)),1)]),t("div",null,[e[29]||(e[29]=t("p",{class:"text-gray-500"},"Seva Schedule Time",-1)),t("p",st,n(R(o.value)),1)]),t("div",null,[e[30]||(e[30]=t("p",{class:"text-gray-500"},"Amount",-1)),t("p",at,"â‚¹"+n(o.value.price||o.value.amount||0),1)]),t("div",null,[e[31]||(e[31]=t("p",{class:"text-gray-500"},"Type",-1)),t("p",ot,n(o.value.seva_type||o.value.seva&&o.value.seva.type||""),1)]),t("div",lt,[e[32]||(e[32]=t("p",{class:"text-gray-500"},"Description",-1)),t("p",nt,n(o.value.seva_description||o.value.seva&&o.value.seva.description||"No description available"),1)]),o.value.special_requests||o.value.SpecialRequests?(m(),c("div",rt,[e[33]||(e[33]=t("p",{class:"text-gray-500"},"Special Requests",-1)),t("p",it,n(o.value.special_requests||o.value.SpecialRequests),1)])):h("",!0)])]),t("div",dt,[t("button",{onClick:e[3]||(e[3]=a=>f.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," Close "),(o.value.status||o.value.Status||"").toLowerCase()==="pending"?(m(),c("button",{key:0,onClick:K,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none"}," Cancel Booking ")):h("",!0)])])):h("",!0)]),_:1},8,["show"]),b(H,{show:x.value,onClose:e[6]||(e[6]=a=>x.value=!1),title:"Cancel Seva Booking"},{default:D(()=>[t("div",ut,[e[34]||(e[34]=t("p",{class:"text-gray-700"},"Are you sure you want to cancel this seva booking? This action cannot be undone.",-1)),t("div",ct,[t("button",{onClick:e[5]||(e[5]=a=>x.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," No, Keep Booking "),t("button",{onClick:W,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none"}," Yes, Cancel Booking ")])])]),_:1},8,["show"])])}}};export{pt as default};
